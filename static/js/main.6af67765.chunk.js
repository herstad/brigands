(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(18),o=n.n(i),c=(n(96),n(90)),u=(n(97),n(80)),l=n.n(u),d=n(81),f=n.n(d),s=n(76),m=n.n(s),p=n(82),v=n.n(p),y=n(79),E=n.n(y),g=n(78),h=n.n(g),b={o:"android",x:"directions_walk",mounted:"direction_bike",grass:"crop_free",tree:"nature",water:"waves",rock:"landscape",dead:"airline_seat_flat",farm:"home",crop:"local_florist",planted:"minimize"},T=function(e){return e.hp<1?b.dead:b[e.type]||"crop_free"},I=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=[],r=0;r<e;r++){n[r]=[];for(var a=0;a<e;a++)n[r][a]=x(t,a,r)}return n},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find(function(e){return e.x===t&&e.y===n})||{x:t,y:n,type:"."}};function A(e){var t,n=e.elem,i=Object(r.useContext)(ot).dispatch;return a.a.createElement(m.a,null,a.a.createElement(h.a,{onClick:(t=n.id,function(){i({type:"SET_SELECTED",payload:t})})},a.a.createElement(E.a,null,T(n))))}function O(){var e=Object(r.useContext)(ot).state.items,t=I(10,e);return a.a.createElement("div",{className:"PlayingField"},a.a.createElement(l.a,{padding:"none"},a.a.createElement(f.a,null,t.map(function(e){return a.a.createElement(v.a,{key:e[0].y},e.map(function(e){return a.a.createElement(A,{key:"x"+e.x+"y"+e.y,elem:e})}))}))))}var j=n(27),C=n.n(j),_=n(28),k=n.n(_),N=n(16),w=n.n(N),R=n(9),M=n(26),P=n(23),S=function(e){return function(t){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?{x:Math.sign(n),y:0}:{x:0,y:Math.sign(r)}}},V=function(e,t){var n=t(e),r=n.x,a=n.y;return Object(R.a)({},e,{x:e.x+r,y:e.y+a})},D=function(e){return function(t){return ne(e,t.items)}},B=function(e){return ne(e.selectedId,e.items)},F=function(e){return e.events},U=function(e){var t=J.findIndex(function(t){return t===e});return J[(t+1)%J.length]},L=function(e){return H("ai",e.items)?"human":H("human",e.items)?"ai":void 0},H=function(e,t){return re(e,t).every(function(e){return e.hp<=0})},K=function(e,t){var n=e.payload.condition,r=void 0!==e.payload.agentId?D(e.payload.agentId)(t):e.payload.getAgent(t),a=Object(R.a)({},r,{ap:0,action:e,condition:n});if(a.training){var i={action:e,condition:n};a.behaviorTraining.conditionalActions.push(i)}else{var o=a.conditionalActions.findIndex(function(t){return t.action.type===e.type});o>0&&(a.conditionalActions=a.conditionalActions.slice(o))}return le(a,t)},G=function(e,t,n){var r=D(e)(n),a=ae(n.items)(r)("grass"),i=oe(a.id,n.items),o={id:q(),builderId:e,x:r.x,y:r.y,type:t,createdTurn:n.turn};return Object(R.a)({},n,{items:[].concat(Object(P.a)(i),[o])})},W=function(e){return function(t){return"planted"===t.type&&t.createdTurn+5<=e}},z=function(e,t){console.log("Action"),console.log(t),console.log("State"),console.log(e);var n,r,a,i=t.payload;switch(t.type){case"END_TURN":var o=fe(function(e){return te(i,e)})({ap:1})(e.items),c=o.filter(W(e.turn)),u=fe(W(e.turn))({type:"crop"})(c),l=de(o)(u),d=u.map(function(t){return{type:"CROP_GROWN",itemId:t.id,turn:e.turn}}),f=[].concat(Object(P.a)(e.events),Object(P.a)(d)).filter(function(t){return t.turn===e.turn});return Object(R.a)({},e,{items:l,turn:(r=e.turn,a=e.activePlayerId,J.slice(-1)[0]===a?r+1:r),activePlayerId:U(e.activePlayerId),winner:L(e),events:f});case"RESTART":return Y();case"SET_SELECTED":return Object(R.a)({},e,{selectedId:i});case"ATTACK":var s=i.getAgent,m=i.getTarget,p=K(t,e),v=s(p),y=m(p);return ue(v,y)?(console.log("target in range!"),le(Object(R.a)({},y,{hp:y.hp-1}),p)):(console.log("target not in range!"),le(V(v,S(y)),p));case"MOVE":var E=i.getAgent,g=i.getTarget,h=K(t,e),b=E(h),T=g(h);return le(V(b,S(T)),h);case"BUILD_FARM":return G(i.agentId,"farm",K(t,e));case"PLANT_CROP":return G(i.agentId,"planted",K(t,e));case"HARVEST_CROP":var I=K(t,e),x=D(i.targetId)(e),A=x.x,O=x.y,j={id:q(),x:A,y:O,type:"grass"};return Object(R.a)({},I,{items:[].concat(Object(P.a)(oe(i.targetId,I.items)),[j])});case"TRAIN_EVENT":var C=i.agentId,_=i.event;return le({id:C,behaviorTraining:{name:"farmer",eventType:_.type,conditionalActions:[]},training:!0},e);case"FINISH_TRAIN_EVENT":var k=i.agentId,N=D(k)(e),w=N.behaviorTraining,B=w.name,F=w.eventType,H=w.conditionalActions,z=e.behaviors[B]||{},$=Object(R.a)({},z,Object(M.a)({name:B},F,{eventType:F,conditionalActions:H})),Q=Object(R.a)({},e,{behaviors:Object(R.a)({},e.behaviors,Object(M.a)({},B,$))});return le(Object(R.a)({},N,{behaviorTraining:{},conditionalActions:H,training:!1}),Q);case"SET_UNIT_BEHAVIOR":var X=i.getAgent(e),Z=(n=X.behaviorName,function(e){return function(t){return((t.behaviors[n]||{})[e]||{}).conditionalActions||[]}})(i.eventType)(e);return console.log("Updated actions for event: "+i.eventType),console.log(Z),le(Object(R.a)({},X,{conditionalActions:Object(P.a)(Z)}),e);default:return e}},J=["human","ai"],Y=function(){console.log("generate state");var e=Q();return{turn:0,activePlayerId:J[0],items:e,selectedId:e[0].id,winner:void 0,events:[{type:"ENEMY_SPOTTED",itemId:e[1].id},{type:"GAME_STARTED"}],behaviors:{},training:!1}},$=0,q=function(){return++$},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=[{id:q(),hp:5,type:"x",playerId:"human",ap:1,behaviorName:"farmer",conditionalActions:[{action:{type:"ATTACK",payload:{getAgent:D(1),getTarget:D(2)}},condition:function(){return!0}}]},{id:q(),hp:5,type:"o",playerId:"ai",ap:1,behaviorName:"farmer",conditionalActions:[{action:{type:"FAKE"},condition:function(){return!1}}]}],n=[{id:q(),type:"tree"},{id:q(),type:"tree"},{id:q(),type:"tree"},{id:q(),type:"tree"},{id:q(),type:"tree"},{id:q(),type:"tree"},{id:q(),type:"rock"},{id:q(),type:"rock"},{id:q(),type:"rock"},{id:q(),type:"water"},{id:q(),type:"water"},{id:q(),type:"water"}],r=X(e);return r(t).concat(r(n.concat(function(e){for(var t=[],n=0;n<e;n++)t.push({id:q(),type:"grass"});return t}(e*e-n.length))))},X=function(e){return function(t){var n=Z(e);return t.map(function(e){return Object(R.a)({},e,n.shift())})}},Z=function(e){var t=Array.from(Array(e).keys()),n=t.map(function(e){return t.map(function(t){return{x:e,y:t}})}).flat();return ee(n),n},ee=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}},te=function(e,t){return t.playerId===e},ne=function(e,t){return t.find(function(t){return t.id===e})},re=function(e,t){return t.filter(function(e){return function(t){return te(e,t)}}(e))},ae=function(e){return function(t){return function(n){return ie(function(e){return function(t){var n=t.x,r=t.y;return e.filter(function(e){return e.x===n&&e.y===r})}}(e)(t))(n)}}},ie=function(e){return function(t){return e.find(function(e){return e.type===t})}},oe=function(e,t){return t.filter(function(t){return t.id!==e})},ce=function(e){return J.filter(function(t){return e.activePlayerId!==t}).flatMap(function(t){return re(t,e.items)})},ue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=n},le=function(e,t){var n=t.items.map(me(e));return Object(R.a)({},t,{items:n})},de=function(e){return function(t){return e.map(function(e){return t.find(function(t){return t.id===e.id})||e})}},fe=function(e){return function(t){return function(n){return n.map(se(e)(t))}}},se=function(e){return function(t){return function(n){return e(n)?Object(R.a)({},n,t):n}}},me=function(e){return se(function(t){return e.id===t.id})(e)},pe=function(e){return function(t){var n=D(e)(t);return n.ap>0&&n.playerId===t.activePlayerId}},ve=function(e){return function(t){return t.items.some(function(n){return"farm"===n.type&&n.builderId===e(t).id})}},ye=function(e,t){return Te(e,t)?"primary":"default"},Ee=function(e){return function(t){return re(e,t).filter(function(e){return e.ap})}},ge=function(e){return function(t){return t.find(function(t){return t.condition(e)})}},he=function(e){return{type:"SET_UNIT_BEHAVIOR",payload:{getAgent:D(e.id),eventType:"DEFAULT_EVENT"}}},be=function(e){return function(t){return t.map(function(t){return ge(e)(t.conditionalActions)||{condition:function(){return!0},action:he(t)}})}},Te=function(e,t){var n=ge(t)(B(t).conditionalActions);return n&&e===n.action.type};function Ie(){var e,t=Object(r.useContext)(ot),n=t.state,i=t.dispatch,o=n.items,c=n.activePlayerId;return a.a.createElement(w.a,{onClick:(e=c,function(){be(n)(Ee(e)(o)).forEach(function(e){return e&&e.condition(n)?i(e.action):void 0}),i({type:"END_TURN",payload:e})})},"Turn(",c,"): ",n.turn)}function xe(e){var t=e.targetId,n=Object(r.useContext)(ot),i=n.state,o=n.dispatch,c=pe(B(i).id);if(!c(i))return null;var u=ye("ATTACK",i);return a.a.createElement(w.a,{color:u,onClick:function(){o({type:"ATTACK",payload:{getAgent:D(i.selectedId),getTarget:D(t),condition:c}})}},"Attack Enemy")}var Ae=function(e){return function(t){return function(n){var r=t(n),a=e(n);return r&&a&&pe(r.id)(n)&&!(r.x===a.x&&r.y===a.y)}}},Oe=function(e){return function(t,n){var r=function(e){return function(t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}}(e);return r(t)-r(n)}},je=function(e){return function(t){return function(n){return n.items.filter(function(e){return e.type===t}).sort(Oe(e(n)))[0]}}},Ce=function(e){return function(t){return function(n){return function(r){return function(){r({type:"MOVE",payload:{getAgent:e,getTarget:t,condition:n}})}}}}};function _e(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch,i=D(t.selectedId),o=je(i)("grass"),c=Ae(o)(i);if(!c(t))return null;var u=ye("MOVE",t),l=Ce(i)(o)(c)(n);return a.a.createElement(w.a,{color:u,onClick:l},"Move To Grass")}function ke(){var e=Object(r.useContext)(ot).state,t=F(e).filter(function(e){return void 0!==e.itemId});return t?t.map(function(e){return a.a.createElement(Ne,{key:e.itemId,event:e})}):null}function Ne(e){var t=e.event,n=Object(r.useContext)(ot),i=n.state,o=n.dispatch,c=D(i.selectedId),u=D(t.itemId),l=Ae(u)(c);if(!l(i))return null;var d=ye("MOVE",i),f=Ce(c)(u)(l)(o);return a.a.createElement(w.a,{color:d,onClick:f},"Move To Event ",t.type," ")}function we(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch,i=B(t),o=D(i.id),c=function(e){return pe(i.id)(e)&&!ve(o)(e)&&ae(e.items)(i)("grass")};if(!c(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"BUILD_FARM",payload:{agentId:i.id,condition:c}})}},"Build farm")}function Re(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch,i=B(t),o=D(i.id),c=function(e){return pe(i.id)(e)&&ve(o)(e)&&ae(e.items)(o(e))("grass")};if(!c(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"PLANT_CROP",payload:{agentId:i.id,condition:c}})}},"PlantCrop")}function Me(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch,i=B(t),o=D(i.id),c=ae(t.items)(o(t))("crop"),u=function(e){return pe(i.id)(e)&&ae(e.items)(o(e))("crop")};if(!u(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"HARVEST_CROP",payload:{agentId:i.id,targetId:c.id,condition:u}})}},"HarvestCrop")}function Pe(){var e=Object(r.useContext)(ot).state;return a.a.createElement("div",null,a.a.createElement(C.a,null,a.a.createElement(k.a,null,a.a.createElement(Ie,null),ce(e).map(function(e){return a.a.createElement(xe,{key:e.id,targetId:e.id})}),a.a.createElement(_e,null),a.a.createElement(ke,null),a.a.createElement(we,null),a.a.createElement(Re,null),a.a.createElement(Me,null))))}var Se=n(17),Ve=n.n(Se),De=n(83),Be=n.n(De);function Fe(){var e=Object(r.useContext)(ot).state,t=B(e);if(void 0===t)return null;var n=t.id,i=t.playerId,o=t.x,c=t.y,u=t.hp,l=t.ap,d=t.type,f=u/5*100,s={type:"DEFAULT_EVENT",itemId:t.id};return a.a.createElement(C.a,null,a.a.createElement(k.a,null,a.a.createElement(Ve.a,null,"id:",n),a.a.createElement(Ve.a,null,"player:",i),a.a.createElement(Ve.a,null,"x:",o),a.a.createElement(Ve.a,null,"y:",c),a.a.createElement(Ve.a,null,"hp:",u),a.a.createElement(Ve.a,null,"ap:",l),a.a.createElement(Ve.a,null,"type:",d),a.a.createElement(Be.a,{variant:"determinate",value:f}),a.a.createElement(Ue,{event:s}),a.a.createElement(Le,null)))}function Ue(e){var t=e.event,n=Object(r.useContext)(ot),i=n.state,o=n.dispatch,c=B(i);if(void 0===c||c.training)return null;return a.a.createElement(w.a,{color:"default",onClick:function(){o({type:"TRAIN_EVENT",payload:{agentId:c.id,event:t}})}},"Train ",t.type," Behavior")}function Le(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch,i=B(t);if(void 0===i||!i.training)return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"FINISH_TRAIN_EVENT",payload:{agentId:i.id}})}},"Finish train event Behavior")}function He(e){var t=e.event,n=Object(r.useContext)(ot).state,i=t.itemId?D(t.itemId)(n):{},o=i.x,c=i.y,u=i.type;return a.a.createElement(C.a,null,a.a.createElement(k.a,null,a.a.createElement(Ve.a,null,"type:",t.type),a.a.createElement(Ve.a,null,"x:",o),a.a.createElement(Ve.a,null,"y:",c),a.a.createElement(Ve.a,null,"itemType:",u),a.a.createElement(Ue,{event:t})))}function Ke(){return Object(r.useContext)(ot).state.events.map(function(e,t){return a.a.createElement(He,{key:"event"+t,event:e})})}function Ge(){return a.a.createElement("div",null,a.a.createElement(Fe,null),a.a.createElement(Ke,null))}var We=n(89),ze=n.n(We),Je=n(29),Ye=n.n(Je),$e=n(84),qe=n.n($e),Qe=n(88),Xe=n.n(Qe),Ze=n(86),et=n.n(Ze),tt=n(87),nt=n.n(tt),rt=n(85),at=n.n(rt);function it(){var e=Object(r.useContext)(ot),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement(qe.a,{open:!!t.winner,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(at.a,{id:"alert-dialog-title"},"The winner is ".concat(t.winner,"!")),a.a.createElement(et.a,null,a.a.createElement(nt.a,{id:"alert-dialog-description"},"Play another round?")),a.a.createElement(Xe.a,null,a.a.createElement(w.a,{onClick:function(){return n({type:"RESTART",payload:void 0})},color:"primary"},"Yes"))))}var ot=a.a.createContext(null),ct=Y();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(function(){var e=Object(r.useReducer)(z,ct),t=Object(c.a)(e,2),n=t[0],i=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement(ze.a,null),a.a.createElement(Ye.a,{container:!0,justify:"center",direction:"row",spacing:24},a.a.createElement(ot.Provider,{value:{state:n,dispatch:i}},a.a.createElement(it,null),a.a.createElement(Ye.a,{item:!0,xs:!0},a.a.createElement(Ge,null)),a.a.createElement(Ye.a,{item:!0,xs:!0},a.a.createElement(O,{size:"10"})),a.a.createElement(Ye.a,{item:!0,xs:4},a.a.createElement(Pe,null)))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},91:function(e,t,n){e.exports=n(212)},96:function(e,t,n){},97:function(e,t,n){}},[[91,1,2]]]);
//# sourceMappingURL=main.6af67765.chunk.js.map