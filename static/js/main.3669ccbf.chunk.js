(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(18),c=n.n(i),o=(n(96),n(90)),u=(n(97),n(80)),l=n.n(u),d=n(81),f=n.n(d),s=n(76),p=n.n(s),m=n(82),y=n.n(m),v=n(79),E=n.n(v),g=n(78),h=n.n(g),I={o:"android",x:"directions_walk",mounted:"direction_bike",grass:"crop_free",tree:"nature",water:"waves",rock:"landscape",dead:"airline_seat_flat",farm:"home",crop:"local_florist",planted:"minimize"},b=function(e){return e.hp<1?I.dead:I[e.type]||"crop_free"},T=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=[],r=0;r<e;r++){n[r]=[];for(var a=0;a<e;a++)n[r][a]=A(t,a,r)}return n},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find(function(e){return e.x===t&&e.y===n})||{x:t,y:n,type:"."}};function x(e){var t,n=e.elem,i=Object(r.useContext)(nt).dispatch;return a.a.createElement(p.a,null,a.a.createElement(h.a,{onClick:(t=n.id,function(){i({type:"SET_SELECTED",payload:t})})},a.a.createElement(E.a,null,b(n))))}function O(){var e=Object(r.useContext)(nt).state.items,t=T(10,e);return a.a.createElement("div",{className:"PlayingField"},a.a.createElement(l.a,{padding:"none"},a.a.createElement(f.a,null,t.map(function(e){return a.a.createElement(y.a,{key:e[0].y},e.map(function(e){return a.a.createElement(x,{key:"x"+e.x+"y"+e.y,elem:e})}))}))))}var C=n(26),j=n.n(C),_=n(27),N=n.n(_),k=n(17),w=n.n(k),R=n(9),M=n(25),P=n(39),S=function(e){return function(t){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?{x:Math.sign(n),y:0}:{x:0,y:Math.sign(r)}}},V=function(e,t){var n=t(e),r=n.x,a=n.y;return Object(R.a)({},e,{x:e.x+r,y:e.y+a})},D=function(e){return function(t){return te(e,t.items)}},B=function(e){return te(e.selectedId,e.items)},F=function(e){var t=z.findIndex(function(t){return t===e});return z[(t+1)%z.length]},U=function(e){return L("ai",e.items)?"human":L("human",e.items)?"ai":void 0},L=function(e,t){return ne(e,t).every(function(e){return e.hp<=0})},H=function(e,t){var n=e.payload.condition,r=void 0!==e.payload.agentId?D(e.payload.agentId)(t):e.payload.getAgent(t),a=Object(R.a)({},r,{ap:0,action:e,condition:n});if(a.training){var i={action:e,condition:n};a.behaviorTraining.conditionalActions.push(i)}else{var c=a.conditionalActions.findIndex(function(t){return t.action.type===e.type});c>0&&(a.conditionalActions=a.conditionalActions.slice(c))}return ue(a,t)},K=function(e,t,n){var r=D(e)(n),a=re(n.items)(r)("grass"),i=ie(a.id,n.items),c={id:$(),builderId:e,x:r.x,y:r.y,type:t,createdTurn:n.turn};return Object(R.a)({},n,{items:[].concat(Object(P.a)(i),[c])})},G=function(e){return function(t){return"planted"===t.type&&t.createdTurn+5<=e}},W=function(e,t){console.log("Action"),console.log(t),console.log(e);var n,r,a,i=t.payload;switch(t.type){case"END_TURN":var c=de(function(e){return ee(i,e)})({ap:1})(e.items),o=c.filter(G(e.turn)),u=de(G(e.turn))({type:"crop"})(o),l=le(c)(u),d=u.map(function(e){return{type:"CROP_GROWN",itemId:e.id}});return Object(R.a)({},e,{items:l,turn:(r=e.turn,a=e.activePlayerId,z.slice(-1)[0]===a?r+1:r),activePlayerId:F(e.activePlayerId),winner:U(e),events:d});case"RESTART":return J();case"SET_SELECTED":return Object(R.a)({},e,{selectedId:i});case"ATTACK":var f=i.getAgent,s=i.getTarget,p=H(t,e),m=f(p),y=s(p);return oe(m,y)?(console.log("target in range!"),ue(Object(R.a)({},y,{hp:y.hp-1}),p)):(console.log("target not in range!"),ue(V(m,S(y)),p));case"MOVE":var v=i.getAgent,E=i.getTarget,g=H(t,e),h=v(g),I=E(g);return ue(V(h,S(I)),g);case"BUILD_FARM":return K(i.agentId,"farm",H(t,e));case"PLANT_CROP":return K(i.agentId,"planted",H(t,e));case"HARVEST_CROP":var b=H(t,e),T=D(i.targetId)(e),A=T.x,x=T.y,O={id:$(),x:A,y:x,type:"grass"};return Object(R.a)({},b,{items:[].concat(Object(P.a)(ie(i.targetId,b.items)),[O])});case"TRAIN_EVENT":var C=i.agentId,j=i.event;return ue({id:C,behaviorTraining:{name:"farmer",eventType:j.type,conditionalActions:[]},training:!0},e);case"FINISH_TRAIN_EVENT":var _=i.agentId,N=D(_)(e),k=N.behaviorTraining,w=k.name,B=k.eventType,L=k.conditionalActions,W=e.behaviors[w]||{},Y=Object(R.a)({},W,Object(M.a)({name:w},B,{eventType:B,conditionalActions:L})),q=Object(R.a)({},e,{behaviors:Object(R.a)({},e.behaviors,Object(M.a)({},w,Y))});return ue(Object(R.a)({},N,{behaviorTraining:{},conditionalActions:L,training:!1}),q);case"SET_UNIT_BEHAVIOR":var Q=i.getAgent(e),X=(n=Q.behaviorName,function(e){return function(t){return((t.behaviors[n]||{})[e]||{}).conditionalActions||[]}})(i.eventType)(e);return console.log("Updated actions for event: "+i.eventType),console.log(X),ue(Object(R.a)({},Q,{conditionalActions:Object(P.a)(X)}),e);default:return e}},z=["human","ai"],J=function(){console.log("generate state");var e=q();return{turn:0,activePlayerId:z[0],items:e,selectedId:e[0].id,winner:void 0,events:[{type:"ENEMY_SPOTTED",itemId:e[1].id},{type:"GAME_STARTED"}],behaviors:{},training:!1}},Y=0,$=function(){return++Y},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=[{id:$(),hp:5,type:"x",playerId:"human",ap:1,behaviorName:"farmer",conditionalActions:[{action:{type:"ATTACK",payload:{getAgent:D(1),getTarget:D(2)}},condition:function(){return!0}}]},{id:$(),hp:5,type:"o",playerId:"ai",ap:1,behaviorName:"farmer",conditionalActions:[{action:{type:"FAKE"},condition:function(){return!1}}]}],n=[{id:$(),type:"tree"},{id:$(),type:"tree"},{id:$(),type:"tree"},{id:$(),type:"tree"},{id:$(),type:"tree"},{id:$(),type:"tree"},{id:$(),type:"rock"},{id:$(),type:"rock"},{id:$(),type:"rock"},{id:$(),type:"water"},{id:$(),type:"water"},{id:$(),type:"water"}],r=Q(e);return r(t).concat(r(n.concat(function(e){for(var t=[],n=0;n<e;n++)t.push({id:$(),type:"grass"});return t}(e*e-n.length))))},Q=function(e){return function(t){var n=X(e);return t.map(function(e){return Object(R.a)({},e,n.shift())})}},X=function(e){var t=Array.from(Array(e).keys()),n=t.map(function(e){return t.map(function(t){return{x:e,y:t}})}).flat();return Z(n),n},Z=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}},ee=function(e,t){return t.playerId===e},te=function(e,t){return t.find(function(t){return t.id===e})},ne=function(e,t){return t.filter(function(e){return function(t){return ee(e,t)}}(e))},re=function(e){return function(t){return function(n){return ae(function(e){return function(t){var n=t.x,r=t.y;return e.filter(function(e){return e.x===n&&e.y===r})}}(e)(t))(n)}}},ae=function(e){return function(t){return e.find(function(e){return e.type===t})}},ie=function(e,t){return t.filter(function(t){return t.id!==e})},ce=function(e){return z.filter(function(t){return e.activePlayerId!==t}).flatMap(function(t){return ne(t,e.items)})},oe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=n},ue=function(e,t){var n=t.items.map(se(e));return Object(R.a)({},t,{items:n})},le=function(e){return function(t){return e.map(function(e){return t.find(function(t){return t.id===e.id})||e})}},de=function(e){return function(t){return function(n){return n.map(fe(e)(t))}}},fe=function(e){return function(t){return function(n){return e(n)?Object(R.a)({},n,t):n}}},se=function(e){return fe(function(t){return e.id===t.id})(e)},pe=function(e){var t=B(e);return t.ap>0&&t.playerId===e.activePlayerId},me=function(e){return e.items.some(function(t){return"farm"===t.type&&t.builderId===e.selectedId})},ye=function(e,t){return Ie(e,t)?"primary":"default"},ve=function(e){return function(t){return ne(e,t).filter(function(e){return e.ap})}},Ee=function(e){return function(t){return t.find(function(t){return t.condition(e)})}},ge=function(e){return function(t){return t.map(function(t){return Ee(e)(t.conditionalActions)})}},he=function(e){return function(t){return t.filter(function(t){return!Ee(e)(t.conditionalActions)})}},Ie=function(e,t){var n=Ee(t)(B(t).conditionalActions);return n&&e===n.action.type};function be(){var e,t=Object(r.useContext)(nt),n=t.state,i=t.dispatch,c=n.items,o=n.activePlayerId;return a.a.createElement(w.a,{onClick:(e=o,function(){he(n)(ve(e)(c)).forEach(function(e){return i({type:"SET_UNIT_BEHAVIOR",payload:{getAgent:D(e.id),eventType:"DEFAULT_EVENT"}})}),ge(n)(ve(e)(c)).forEach(function(e){return e&&e.condition(n)?i(e.action):void 0}),i({type:"END_TURN",payload:e})})},"Turn(",o,"): ",n.turn)}function Te(e){var t=e.targetId,n=Object(r.useContext)(nt),i=n.state,c=n.dispatch,o=pe;if(!o(i))return null;var u=ye("ATTACK",i);return a.a.createElement(w.a,{color:u,onClick:function(){c({type:"ATTACK",payload:{getAgent:D(i.selectedId),getTarget:D(t),condition:o}})}},"Attack Enemy")}var Ae=function(e){return function(t){var n=B(t),r=e(t);return pe(t)&&!(n.x===r.x&&n.y===r.y)}},xe=function(e){return function(t,n){var r=function(e){return function(t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}}(e);return r(t)-r(n)}},Oe=function(e){return function(t){return function(n){return n.items.filter(function(e){return e.type===t}).sort(xe(e))[0]}}};function Ce(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch,i=B(t),c=Oe(i)("grass"),o=Ae(c);if(!o(t))return null;var u=ye("MOVE",t);return a.a.createElement(w.a,{color:u,onClick:function(){var e=t.selectedId;n({type:"MOVE",payload:{getAgent:D(e),getTarget:c,condition:o}})}},"Move To Grass")}function je(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch,i=function(e){return pe(e)&&!me(e)&&re(e.items)(B(e))("grass")};if(!i(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"BUILD_FARM",payload:{agentId:t.selectedId,condition:i}})}},"Build farm")}function _e(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch,i=function(e){return pe(e)&&me(e)&&re(e.items)(B(e))("grass")};if(!i(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"PLANT_CROP",payload:{agentId:t.selectedId,condition:i}})}},"PlantCrop")}function Ne(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch,i=B(t),c=re(t.items)(i)("crop"),o=function(e){var t=B(e),n=re(e.items)(t)("crop");return pe(e)&&!!n};if(!o(t))return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"HARVEST_CROP",payload:{agentId:t.selectedId,targetId:c.id,condition:o}})}},"HarvestCrop")}function ke(){var e=Object(r.useContext)(nt).state;return a.a.createElement("div",null,a.a.createElement(j.a,null,a.a.createElement(N.a,null,a.a.createElement(be,null),ce(e).map(function(e){return a.a.createElement(Te,{key:e.id,targetId:e.id})}),a.a.createElement(Ce,null),a.a.createElement(je,null),a.a.createElement(_e,null),a.a.createElement(Ne,null))))}var we=n(16),Re=n.n(we),Me=n(83),Pe=n.n(Me);function Se(){var e=Object(r.useContext)(nt).state,t=B(e);if(void 0===t)return null;var n=t.id,i=t.playerId,c=t.x,o=t.y,u=t.hp,l=t.ap,d=t.type,f=u/5*100,s={type:"DEFAULT_EVENT",itemId:t.id};return a.a.createElement(j.a,null,a.a.createElement(N.a,null,a.a.createElement(Re.a,null,"id:",n),a.a.createElement(Re.a,null,"player:",i),a.a.createElement(Re.a,null,"x:",c),a.a.createElement(Re.a,null,"y:",o),a.a.createElement(Re.a,null,"hp:",u),a.a.createElement(Re.a,null,"ap:",l),a.a.createElement(Re.a,null,"type:",d),a.a.createElement(Pe.a,{variant:"determinate",value:f}),a.a.createElement(Ve,{event:s}),a.a.createElement(De,null)))}function Ve(e){var t=e.event,n=Object(r.useContext)(nt),i=n.state,c=n.dispatch;if(void 0===i.selectedId)return null;return a.a.createElement(w.a,{color:"default",onClick:function(){c({type:"TRAIN_EVENT",payload:{agentId:t.itemId,event:t}})}},"Train Default Behavior")}function De(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch;if(void 0===t.selectedId)return null;return a.a.createElement(w.a,{color:"default",onClick:function(){n({type:"FINISH_TRAIN_EVENT",payload:{agentId:t.selectedId}})}},"Finish train Default Behavior")}function Be(e){var t=e.event,n=Object(r.useContext)(nt).state,i=t.itemId?D(t.itemId)(n):{},c=i.x,o=i.y,u=i.type;return a.a.createElement(j.a,null,a.a.createElement(N.a,null,a.a.createElement(Re.a,null,"type:",t.type),a.a.createElement(Re.a,null,"x:",c),a.a.createElement(Re.a,null,"y:",o),a.a.createElement(Re.a,null,"itemType:",u)))}function Fe(){return Object(r.useContext)(nt).state.events.map(function(e,t){return a.a.createElement(Be,{key:"event"+t,event:e})})}function Ue(){return a.a.createElement("div",null,a.a.createElement(Se,null),a.a.createElement(Fe,null))}var Le=n(89),He=n.n(Le),Ke=n(28),Ge=n.n(Ke),We=n(84),ze=n.n(We),Je=n(88),Ye=n.n(Je),$e=n(86),qe=n.n($e),Qe=n(87),Xe=n.n(Qe),Ze=n(85),et=n.n(Ze);function tt(){var e=Object(r.useContext)(nt),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement(ze.a,{open:!!t.winner,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(et.a,{id:"alert-dialog-title"},"The winner is ".concat(t.winner,"!")),a.a.createElement(qe.a,null,a.a.createElement(Xe.a,{id:"alert-dialog-description"},"Play another round?")),a.a.createElement(Ye.a,null,a.a.createElement(w.a,{onClick:function(){return n({type:"RESTART",payload:void 0})},color:"primary"},"Yes"))))}var nt=a.a.createContext(null),rt=J();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(function(){var e=Object(r.useReducer)(W,rt),t=Object(o.a)(e,2),n=t[0],i=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement(He.a,null),a.a.createElement(Ge.a,{container:!0,justify:"center",direction:"row",spacing:24},a.a.createElement(nt.Provider,{value:{state:n,dispatch:i}},a.a.createElement(tt,null),a.a.createElement(Ge.a,{item:!0,xs:!0},a.a.createElement(Ue,null)),a.a.createElement(Ge.a,{item:!0,xs:!0},a.a.createElement(O,{size:"10"})),a.a.createElement(Ge.a,{item:!0,xs:4},a.a.createElement(ke,null)))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},91:function(e,t,n){e.exports=n(212)},96:function(e,t,n){},97:function(e,t,n){}},[[91,1,2]]]);
//# sourceMappingURL=main.3669ccbf.chunk.js.map