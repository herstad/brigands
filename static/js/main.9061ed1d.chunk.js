(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(19),c=n.n(i),u=(n(94),n(88)),o=(n(95),n(78)),l=n.n(o),d=n(79),f=n.n(d),s=n(74),v=n.n(s),m=n(80),p=n.n(m),E=n(77),y=n.n(E),g=n(76),b=n.n(g),h={o:"android",x:"directions_walk",mounted:"direction_bike",grass:"crop_free",tree:"nature",water:"waves",rock:"landscape",dead:"airline_seat_flat",farm:"home",crop:"local_florist",planted:"minimize"},T=function(e){return e.hp<1?h.dead:h[e.type]||"crop_free"},O=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=[],r=0;r<e;r++){n[r]=[];for(var a=0;a<e;a++)n[r][a]=A(t,a,r)}return n},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find(function(e){return e.x===t&&e.y===n})||{x:t,y:n,type:"."}};function I(e){var t,n=e.elem,i=Object(r.useContext)(Et).dispatch;return a.a.createElement(v.a,null,a.a.createElement(b.a,{onClick:(t=n.id,function(){i({type:"SET_SELECTED",payload:t})})},a.a.createElement(y.a,null,T(n))))}function j(){var e=Object(r.useContext)(Et).state.items,t=O(10,e);return a.a.createElement("div",{className:"PlayingField"},a.a.createElement(l.a,{padding:"none"},a.a.createElement(f.a,null,t.map(function(e){return a.a.createElement(p.a,{key:e[0].y},e.map(function(e){return a.a.createElement(I,{key:"x"+e.x+"y"+e.y,elem:e})}))}))))}var x=n(27),C=n.n(x),_=n(28),N=n.n(_),R=n(13),k=n.n(R),w=n(5),P=["human"],S=function(){console.log("generate state");var e=U();return{turn:0,activePlayerId:P[0],items:e,selectedId:e[0].id,winner:void 0,events:[{type:"ENEMY_SPOTTED",itemId:e[1].id},{type:"GAME_STARTED"}],behaviors:{},training:!1}},V=0,M=function(){return++V},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=[{id:M(),hp:5,type:"x",playerId:"human",ap:1,behaviorName:"farmer",conditionalActions:[],events:[],activeEvent:{type:"DEFAULT_EVENT"},resources:[]},{id:M(),hp:5,type:"o",playerId:"ai",ap:1,behaviorName:"farmer",conditionalActions:[],events:[],activeEvent:{type:"DEFAULT_EVENT"},resources:[]}],n=[{id:M(),type:"tree"},{id:M(),type:"tree"},{id:M(),type:"tree"},{id:M(),type:"tree"},{id:M(),type:"tree"},{id:M(),type:"tree"},{id:M(),type:"rock"},{id:M(),type:"rock"},{id:M(),type:"rock"},{id:M(),type:"water"},{id:M(),type:"water"},{id:M(),type:"water"}],r=D(e);return r(t).concat(r(n.concat(function(e){for(var t=[],n=0;n<e;n++)t.push({id:M(),type:"grass"});return t}(e*e-n.length))))},D=function(e){return function(t){var n=L(e);return t.map(function(e){return Object(w.a)({},e,n.shift())})}},L=function(e){var t=Array.from(Array(e).keys()),n=t.map(function(e){return t.map(function(t){return{x:e,y:t}})}).flat();return F(n),n},F=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}},B=function(e,t){return t.playerId===e},H=function(e,t){return t.find(function(t){return t.id===e})},G=function(e,t){return t.filter(function(e){return function(t){return B(e,t)}}(e))},K=function(e){return function(t){return function(n){return W(function(e){return function(t){var n=t.x,r=t.y;return e.filter(function(e){return e.x===n&&e.y===r})}}(e)(t))(n)}}},W=function(e){return function(t){return e.find(function(e){return e.type===t})}},z=function(e){return P.filter(function(t){return e.activePlayerId!==t}).flatMap(function(t){return G(t,e.items)})},J=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=n},Y=function(e){return function(t){var n=t.items.map(Z(e));return Object(w.a)({},t,{items:n})}},$=function(e,t){var n=t.items.map(Z(e));return Object(w.a)({},t,{items:n})},q=function(e){return function(t){return e.map(function(e){return t.find(function(t){return t.id===e.id})||e})}},Q=function(e){return function(t){return function(n){return n.map(X(e)(t))}}},X=function(e){return function(t){return function(n){return e(n)?Object(w.a)({},n,t):n}}},Z=function(e){return X(function(t){return e.id===t.id})(e)},ee=n(26),te=n(18),ne=function(e){return function(t){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?{x:Math.sign(n),y:0}:{x:0,y:Math.sign(r)}}},re=function(e,t){var n=t(e),r=n.x,a=n.y;return Object(w.a)({},e,{x:e.x+r,y:e.y+a})},ae=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce(function(e,t){return t(e)},e)}},ie=function(e){return function(t){return H(e,t.items)}},ce=function(e){return H(e.selectedId,e.items)},ue=function(e){return function(t){return function(n){return((n.behaviors[e]||{})[t]||{}).conditionalActions||[]}}},oe=function(e){var t=P.findIndex(function(t){return t===e});return P[(t+1)%P.length]},le=function(e,t){return P.slice(-1)[0]===t?e+1:e},de=function(e){return fe("ai",e.items)?"human":fe("human",e.items)?"ai":void 0},fe=function(e,t){return G(e,t).every(function(e){return e.hp<=0})},se=function(e,t){var n=e.payload.condition,r=void 0!==e.payload.agentId?ie(e.payload.agentId)(t):e.payload.getAgent(t),a=Object(w.a)({},r,{ap:0,action:e,condition:n});if(a.training){var i={action:e,condition:n};a.behaviorTraining.conditionalActions.push(i)}else if(a.conditionalActions){var c=a.conditionalActions.findIndex(function(t){return t.action.type===e.type});c>0&&(a.conditionalActions=a.conditionalActions.slice(c))}return Y(a)(t)},ve=function(e){return function(t){return se(e,t)}},me=function(e,t,n){var r=ie(e)(n),a=K(n.items)(r)("grass");return pe(e)(t)(a.id)(n)},pe=function(e){return function(t){return function(n){return function(r){var a,i=ie(e)(r),c=(a=n,r.items.filter(function(e){return e.id!==a})),u={id:M(),builderId:e,x:i.x,y:i.y,type:t,createdTurn:r.turn,resources:[]};return Object(w.a)({},r,{items:[].concat(Object(te.a)(c),[u])})}}}},Ee=function(e){return function(t){return"planted"===t.type&&t.createdTurn+5<=e}},ye=function(e){return function(t){return function(n){return!!ue(e.behaviorName)(t.type)(n).length}}},ge=function(e){return function(t){return t.find(function(t){return t.condition(e)})}},be=function(e){return{type:"SET_UNIT_BEHAVIOR",payload:{getAgent:e}}};function he(e,t){console.log("Action"),console.log(t);var n=t.payload;switch(t.type){case"END_TURN":var r=Q(function(e){return B(n,e)})({ap:1})(e.items),a=r.filter(Ee(e.turn)),i=Q(Ee(e.turn))({type:"crop"})(a),c=q(r)(i),u=i.map(function(t){return{id:M(),type:"CROP_GROWN",itemId:t.id,turn:e.turn}}),o=[].concat(Object(te.a)(e.events),Object(te.a)(u)).filter(function(t){return t.turn===e.turn}),l=G(e.activePlayerId,c).map(function(t){return Object(w.a)({},t,{events:[].concat(Object(te.a)(t.events),Object(te.a)(o.filter(function(n){return ye(t)(n)(e)||t.training})))})});return c=q(c)(l),Object(w.a)({},e,{items:c,turn:le(e.turn,e.activePlayerId),activePlayerId:oe(e.activePlayerId),winner:de(e),events:o});case"AUTO_ACTION":var d=n.getAgent,f=d(e);console.log(f);var s=ge(e)(f.conditionalActions);return s?he(e,s.action):he(he(e,be(d)),t);case"RESTART":var v=e.behaviors;return Object(w.a)({},S(),{behaviors:v});case"SET_SELECTED":return Object(w.a)({},e,{selectedId:n});case"ATTACK":var m=n.getAgent,p=n.getTarget,E=m(e),y=p(e);if(!J(E,y))return console.log("target not in range!"),e;var g=Object(w.a)({},y,{hp:y.hp-1});return ae(Y(g),ve(t))(e);case"MOVE":var b=n.getAgent,h=n.getTarget;return ae(function(e){return Y(re(b(e),ne(h(e))))(e)},ve(t))(e);case"BUILD_FARM":return me(n.agentId,"farm",se(t,e));case"PLANT_CROP":return me(n.agentId,"planted",se(t,e));case"HARVEST_CROP":var T=n.getAgent(e),O=K(e.items)(T)("crop"),A=$(Object(w.a)({},T,{resources:[].concat(Object(te.a)(T.resources),["crop"])}),e);return pe(T.id)("grass")(O.id)(se(t,A));case"UNLOAD_RESOURCE":var I=n.getAgent(e),j=K(e.items)(I)("farm"),x=Object(w.a)({},j,{resources:[].concat(Object(te.a)(j.resources),[I.resources[0]])}),C=Object(w.a)({},I,{resources:I.resources.slice(1)});return ae(Y(C),Y(x),ve(t))(e);case"TRAIN_EVENT":var _=n.agentId,N=n.event;return $({id:_,behaviorTraining:{name:"farmer",eventType:N.type,event:N,conditionalActions:[]},training:!0},e);case"FINISH_TRAIN_EVENT":var R=n.agentId,k=ie(R)(e),P=k.behaviorTraining,V=P.name,U=P.eventType,D=P.conditionalActions,L=e.behaviors[V]||{},F=Object(w.a)({},L,Object(ee.a)({name:V},U,{eventType:U,conditionalActions:D})),H=Object(w.a)({},e,{behaviors:Object(w.a)({},e.behaviors,Object(ee.a)({},V,F))});return $(Object(w.a)({},k,{behaviorTraining:{},conditionalActions:D,training:!1}),H);case"SET_ACTIVE_EVENT":var W=n.event,z=(0,n.getAgent)(e);return $(Object(w.a)({},z,{activeEvent:W}),e);case"SET_UNIT_BEHAVIOR":var X=n.getAgent(e),Z=X.events.length>0?X.events[0]:{type:"DEFAULT_EVENT"},ce=ue(X.behaviorName)(Z.type)(e);return"DEFAULT_EVENT"!==Z.type||ge(e)(ce)?(console.log("Updated actions for event: "+Z.type),$(Object(w.a)({},X,{activeEvent:Z,events:X.events.slice(1),conditionalActions:Object(te.a)(ce)}),e)):Y(Object(w.a)({},X,{activeEvent:{type:"SLEEPING"},conditionalActions:[{action:{type:"SLEEP",payload:{}},condition:function(){return!0}}]}))(e);default:return e}}var Te=function(e){return function(t){return t.items.some(function(n){return"farm"===n.type&&n.builderId===e(t).id})}},Oe=function(e,t){return Ie(e,t)?"primary":"default"},Ae=function(e){return function(t){return G(e,t).filter(function(e){return e.ap>0})}},Ie=function(e,t){var n=function(e){return function(t){return t.find(function(t){return t.condition(e)})}}(t)(ce(t).conditionalActions);return n&&e===n.action.type};function je(){var e,t=Object(r.useContext)(Et),n=t.state,i=t.dispatch,c=n.items,u=n.activePlayerId;return a.a.createElement(k.a,{onClick:(e=u,function(){Ae(e)(c).forEach(function(e){i({type:"AUTO_ACTION",payload:{getAgent:ie(e.id)}})}),i({type:"END_TURN",payload:e})})},"Turn(",u,"): ",n.turn)}var xe=function(e){return function(t){return function(n){return function(e){return function(t){var n=ie(e)(t);return n.ap>0&&n.playerId===t.activePlayerId}}(e)(n)&&t(n)}}};function Ce(e){var t=e.targetId,n=Object(r.useContext)(Et),i=n.state,c=n.dispatch,u=ie(i.selectedId),o=ie(t),l=function(){return!0};if(!xe(i.selectedId)(l)(i))return null;var d=Oe("ATTACK",i);return a.a.createElement(k.a,{color:d,onClick:function(){c({type:"ATTACK",payload:{getAgent:u,getTarget:o,condition:l}})}},"Attack Enemy")}var _e=function(e){return function(t){return function(n){var r=t(n),a=e(n);return r&&a&&!(r.x===a.x&&r.y===a.y)}}},Ne=function(e){return function(t,n){var r=function(e){return function(t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}}(e);return r(t)-r(n)}},Re=function(e){return function(t){return function(n){return n.items.filter(function(e){return e.type===t}).sort(Ne(e(n)))[0]}}},ke=function(e){return function(t){return t.items.filter(function(n){return"farm"===n.type&&n.builderId===e(t).id})[0]}},we=function(e){return function(t){return function(n){return function(r){return function(){r({type:"MOVE",payload:{getAgent:e,getTarget:t,condition:n}})}}}}};function Pe(){var e=Object(r.useContext)(Et).state,t=ie(e.selectedId),n=Re(t)("grass");return a.a.createElement(Ue,{getTarget:n,targetName:"Grass"})}var Se=function(e){return function(t){var n=e(t).activeEvent;return ie(n.itemId)(t)}};function Ve(){var e=Object(r.useContext)(Et).state,t=ie(e.selectedId),n=Se(t);return a.a.createElement(Ue,{getTarget:n,targetName:"Event"})}function Me(){var e=Object(r.useContext)(Et).state,t=ie(e.selectedId),n=ke(t);return a.a.createElement(Ue,{getTarget:n,targetName:"Home"})}function Ue(e){var t=e.getTarget,n=e.targetName,i=Object(r.useContext)(Et),c=i.state,u=i.dispatch,o=ie(c.selectedId),l=_e(t)(o);if(!xe(c.selectedId)(l)(c))return null;var d=Oe("MOVE",c),f=we(o)(t)(l)(u);return a.a.createElement(k.a,{color:d,onClick:f},"Move To ",n)}function De(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch,i=ce(t),c=ie(i.id),u=function(e){return!Te(c)(e)&&K(e.items)(i)("grass")};if(!xe(i.id)(u)(t))return null;return a.a.createElement(k.a,{color:"default",onClick:function(){n({type:"BUILD_FARM",payload:{agentId:i.id,condition:u}})}},"Build farm")}function Le(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch,i=ce(t),c=ie(i.id),u=function(e){return Te(c)(e)&&K(e.items)(c(e))("grass")};if(!xe(i.id)(u)(t))return null;return a.a.createElement(k.a,{color:"default",onClick:function(){n({type:"PLANT_CROP",payload:{agentId:i.id,condition:u}})}},"PlantCrop")}function Fe(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch,i=ce(t),c=ie(i.id),u=function(e){return K(e.items)(c(e))("crop")};if(!xe(i.id)(u)(t))return null;return a.a.createElement(k.a,{color:"default",onClick:function(){n({type:"HARVEST_CROP",payload:{getAgent:c,condition:u}})}},"HarvestCrop")}var Be=function(e){return function(t){var n=e(t);return n.resources.length>0&&K(t.items)(n)("farm")}};function He(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch,i=ie(t.selectedId),c=Be(i);if(!xe(t.selectedId)(c)(t))return null;return a.a.createElement(k.a,{color:"default",onClick:function(){n({type:"UNLOAD_RESOURCE",payload:{getAgent:i,condition:c}})}},"Unload Resource")}function Ge(){var e=Object(r.useContext)(Et).state;return a.a.createElement("div",null,a.a.createElement(C.a,null,a.a.createElement(N.a,null,a.a.createElement(je,null),z(e).map(function(e){return a.a.createElement(Ce,{key:e.id,targetId:e.id})}),a.a.createElement(Pe,null),a.a.createElement(Ve,null),a.a.createElement(Me,null),a.a.createElement(De,null),a.a.createElement(Le,null),a.a.createElement(Fe,null),a.a.createElement(He,null))))}var Ke=n(14),We=n.n(Ke),ze=n(81),Je=n.n(ze);function Ye(){var e=Object(r.useContext)(Et).state,t=ce(e);if(void 0===t)return null;var n=t.id,i=t.playerId,c=t.x,u=t.y,o=t.hp,l=t.ap,d=t.type,f=t.resources,s=o/5*100,v={type:"DEFAULT_EVENT",itemId:t.id};return a.a.createElement(C.a,null,a.a.createElement(N.a,null,a.a.createElement(We.a,null,"id:",n),a.a.createElement(We.a,null,"player:",i),a.a.createElement(We.a,null,"x:",c),a.a.createElement(We.a,null,"y:",u),a.a.createElement(We.a,null,"hp:",o),a.a.createElement(We.a,null,"ap:",l),a.a.createElement(We.a,null,"type:",d),a.a.createElement(We.a,null,"resource: ",f," "),a.a.createElement(Je.a,{variant:"determinate",value:s}),a.a.createElement(qe,{event:v}),a.a.createElement(Qe,null)))}function $e(e){var t=e.event,n=Object(r.useContext)(Et),i=n.state,c=n.dispatch,u=ce,o=u(i);if(void 0===o||o.activeEvent===t)return null;return a.a.createElement(k.a,{color:"default",onClick:function(){c({type:"SET_ACTIVE_EVENT",payload:{getAgent:u,event:t}})}},"Select event ",t.type)}function qe(e){var t=e.event,n=Object(r.useContext)(Et),i=n.state,c=n.dispatch,u=ce(i);if(void 0===u||u.training)return null;return a.a.createElement(k.a,{color:"default",onClick:function(){c({type:"SET_ACTIVE_EVENT",payload:{event:t,getAgent:ie(u.id)}}),c({type:"TRAIN_EVENT",payload:{agentId:u.id,event:t}})}},"Train ",t.type," Behavior")}function Qe(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch,i=ce(t);if(void 0===i||!i.training)return null;return a.a.createElement(k.a,{color:"default",onClick:function(){n({type:"FINISH_TRAIN_EVENT",payload:{agentId:i.id}})}},"Finish train event Behavior")}function Xe(e){var t=e.event,n=Object(r.useContext)(Et).state,i=t.itemId&&ie(t.itemId)(n)||{},c=i.x,u=i.y,o=i.type;return a.a.createElement(C.a,null,a.a.createElement(N.a,null,a.a.createElement(We.a,null,"type:",t.type),a.a.createElement(We.a,null,"x:",c),a.a.createElement(We.a,null,"y:",u),a.a.createElement(We.a,null,"itemType:",o),a.a.createElement($e,{event:t}),a.a.createElement(qe,{event:t})))}function Ze(){var e=Object(r.useContext)(Et).state,t=e.events,n=ce(e);return(n.activeEvent?[n.activeEvent].concat(Object(te.a)(t)):t).map(function(e,t){return a.a.createElement(Xe,{key:"event"+t,event:e})})}function et(){return a.a.createElement("div",null,a.a.createElement(Ye,null),a.a.createElement(Ze,null))}var tt=n(87),nt=n.n(tt),rt=n(29),at=n.n(rt),it=n(82),ct=n.n(it),ut=n(86),ot=n.n(ut),lt=n(84),dt=n.n(lt),ft=n(85),st=n.n(ft),vt=n(83),mt=n.n(vt);function pt(){var e=Object(r.useContext)(Et),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement(ct.a,{open:!!t.winner,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(mt.a,{id:"alert-dialog-title"},"The winner is ".concat(t.winner,"!")),a.a.createElement(dt.a,null,a.a.createElement(st.a,{id:"alert-dialog-description"},"Play another round?")),a.a.createElement(ot.a,null,a.a.createElement(k.a,{onClick:function(){return n({type:"RESTART",payload:void 0})},color:"primary"},"Yes"))))}var Et=a.a.createContext(null),yt=S();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(function(){var e=Object(r.useReducer)(he,yt),t=Object(u.a)(e,2),n=t[0],i=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement(nt.a,null),a.a.createElement(at.a,{container:!0,justify:"center",direction:"row",spacing:24},a.a.createElement(Et.Provider,{value:{state:n,dispatch:i}},a.a.createElement(pt,null),a.a.createElement(at.a,{item:!0,xs:!0},a.a.createElement(et,null)),a.a.createElement(at.a,{item:!0,xs:!0},a.a.createElement(j,{size:"10"})),a.a.createElement(at.a,{item:!0,xs:4},a.a.createElement(Ge,null)))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},89:function(e,t,n){e.exports=n(213)},94:function(e,t,n){},95:function(e,t,n){}},[[89,1,2]]]);
//# sourceMappingURL=main.9061ed1d.chunk.js.map