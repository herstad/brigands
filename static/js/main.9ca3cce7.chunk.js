(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(19),u=n.n(i),c=(n(94),n(88)),o=(n(95),n(78)),l=n.n(o),s=n(79),d=n.n(s),f=n(74),v=n.n(f),m=n(80),p=n.n(m),g=n(77),y=n.n(g),E=n(76),b=n.n(E),h=n(26),A=n(17),O=n(5),T=["human","ai"],j=function(){console.log("generate state");var e=C();return{turn:0,activePlayerId:T[0],items:e,selectedId:e[0].id,winner:void 0,events:[{type:"ENEMY_SPOTTED",itemId:e[1].id},{type:"GAME_STARTED"}],behaviors:{},training:!1}},x=0,I=function(){return++x},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=[{id:I(),hp:5,type:"x",playerId:"human",ap:1,behaviorName:"farmer",conditionalActions:[],events:[],activeEvent:{type:"DEFAULT_EVENT"},resources:[]},{id:I(),hp:5,type:"o",playerId:"ai",ap:1,behaviorName:"brigand",conditionalActions:[],events:[],activeEvent:{type:"DEFAULT_EVENT"},resources:[]},{id:I(),hp:5,type:"x",playerId:"human",ap:1,behaviorName:"farmer",conditionalActions:[],events:[],activeEvent:{type:"DEFAULT_EVENT"},resources:[]}],n=[{id:I(),type:"tree"},{id:I(),type:"tree"},{id:I(),type:"tree"},{id:I(),type:"tree"},{id:I(),type:"tree"},{id:I(),type:"tree"},{id:I(),type:"rock"},{id:I(),type:"rock"},{id:I(),type:"rock"},{id:I(),type:"water"},{id:I(),type:"water"},{id:I(),type:"water"}],r=N(e);return r(t).concat(r(n.concat(function(e){for(var t=[],n=0;n<e;n++)t.push({id:I(),type:"grass"});return t}(e*e-n.length))))},N=function(e){return function(t){var n=_(e);return t.map(function(e){return Object(O.a)({},e,n.shift())})}},_=function(e){var t=Array.from(Array(e).keys()),n=t.map(function(e){return t.map(function(t){return{x:e,y:t}})}).flat();return w(n),n},w=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}},k=function(e,t){return t.playerId===e},R=function(e,t){return t.find(function(t){return t.id===e})},P=function(e,t){return t.filter(function(e){return function(t){return k(e,t)}}(e))},M=function(e){return function(t){return function(n){return U(function(e){return function(t){var n=t.x,r=t.y;return e.filter(function(e){return e.x===n&&e.y===r})}}(e)(t))(n)}}},U=function(e){return function(t){return e.find(function(e){return e.type===t})}},S=function(e){return T.filter(function(t){return e.activePlayerId!==t}).flatMap(function(t){return P(t,e.items)})},D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=n},L=function(e){return function(t){var n=t.items.map(G(e));return Object(O.a)({},t,{items:n})}},V=function(e,t){var n=t.items.map(G(e));return Object(O.a)({},t,{items:n})},F=function(e){return function(t){return e.map(function(e){return t.find(function(t){return t.id===e.id})||e})}},B=function(e){return function(t){return function(n){return n.map(H(e)(t))}}},H=function(e){return function(t){return function(n){return e(n)?Object(O.a)({},n,t):n}}},G=function(e){return H(function(t){return e.id===t.id})(e)},W=function(e){return function(t){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?{x:Math.sign(n),y:0}:{x:0,y:Math.sign(r)}}},z=function(e,t){var n=t(e),r=n.x,a=n.y;return Object(O.a)({},e,{x:e.x+r,y:e.y+a})},J=function(e){return function(t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}},Y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce(function(e,t){return t(e)},e)}},K="brigands/reducer/ATTACK",$="brigands/reducer/AUTO_ACTION",q="brigands/reducer/BUILD_FARM",Q="brigands/reducer/BUILD_WAREHOUSE",X="brigands/reducer/END_TURN",Z="brigands/reducer/FINISH_TRAIN_EVENT",ee="brigands/reducer/HARVEST_CROP",te="brigands/reducer/MOVE",ne="brigands/reducer/PLANT_CROP",re="brigands/reducer/RESTART",ae="brigands/reducer/SET_ACTIVE_EVENT",ie="brigands/reducer/SET_SELECTED",ue="brigands/reducer/SET_UNIT_BEHAVIOR",ce="brigands/reducer/TRAIN_EVENT",oe="brigands/reducer/UNLOAD_RESOURCE",le="brigands/reducer/SLEEP",se=function(e){return function(t){return R(e,t.items)}},de=function(e){return R(e.selectedId,e.items)},fe=function(e){return function(t){return function(n){return((n.behaviors[e]||{})[t]||{}).conditionalActions||[]}}},ve=function(e){return e.activePlayerId},me=function(e){var t=T.findIndex(function(t){return t===e});return T[(t+1)%T.length]},pe=function(e,t){return T.slice(-1)[0]===t?e+1:e},ge=function(e){return ye("ai",e.items)?"human":ye("human",e.items)?"ai":void 0},ye=function(e,t){return P(e,t).every(function(e){return e.hp<=0})},Ee=function(e,t){var n=e.payload.condition,r=void 0!==e.payload.agentId?se(e.payload.agentId)(t):e.payload.getAgent(t),a=Object(O.a)({},r,{ap:0,action:e,condition:n});if(a.training)a.behaviorTraining.conditionalActions.push(e);else if(a.conditionalActions){var i=a.conditionalActions.findIndex(function(t){return t.type===e.type});i>0&&(a.conditionalActions=a.conditionalActions.slice(i))}return L(a)(t)},be=function(e){return function(t){return Ee(e,t)}},he=function(e,t,n){var r=e(n),a=M(n.items)(r)("grass");return Ae(e)(t)(a.id)(n)},Ae=function(e){return function(t){return function(n){return function(r){var a,i=e(r),u=(a=n,r.items.filter(function(e){return e.id!==a})),c={id:I(),builderId:i.id,x:i.x,y:i.y,type:t,createdTurn:r.turn,resources:[]};return Object(O.a)({},r,{items:[].concat(Object(A.a)(u),[c])})}}}},Oe=function(e){return function(t){return"planted"===t.type&&t.createdTurn+5<=e}},Te=function(e){return function(t){return function(n){return!!fe(e.behaviorName)(t.type)(n).length}}},je=function(e){return function(t){return function(n){return n.find(function(n){return n.payload.condition(e)(t)})}}},xe=function(){return{type:X}},Ie=function(e){return function(t){return function(n){return J(t(n))(e(t)(n))<=1}}},Ce=function(e){return function(t){return{type:K,payload:{getAgent:e,getTarget:t,condition:Ie(t)}}}},Ne=function(e){return{type:ue,payload:{getAgent:e}}},_e=function(e){return{type:$,payload:{getAgent:e}}},we=function(e){return{type:Q,payload:{getAgent:e,condition:(t="warehouse",function(e){return function(n){return!n.items.some(function(e){return e.type===t})&&M(n.items)(e(n))("grass")}})}};var t},ke=function(e){return function(t){return t.items.some(function(n){return"farm"===n.type&&n.builderId===e(t).id})}},Re=function(e){return function(t){return!ke(e)(t)&&M(t.items)(e(t))("grass")}},Pe=function(e){return{type:q,payload:{getAgent:e,condition:Re}}},Me=function(e){return function(t){return ke(e)(t)&&M(t.items)(e(t))("grass")}},Ue=function(e){return{type:ne,payload:{getAgent:e,condition:Me}}},Se=function(e){return function(t){return M(t.items)(e(t))("crop")}},De=function(e){return{type:ee,payload:{getAgent:e,condition:Se}}},Le=function(e){return function(t){var n=function(e){return function(t){return function(n){var r=t(n),a=e(t)(n);return r&&a&&!(r.x===a.x&&r.y===a.y)}}}(t);return{type:te,payload:{getAgent:e,getTarget:t,condition:n}}}},Ve=function(e){return function(t){var n=e(t);return n.resources.length>0&&M(t.items)(n)("farm")}},Fe=function(e){return{type:oe,payload:{getAgent:e,condition:Ve}}},Be=function(e){return function(t){return{type:ae,payload:{getAgent:e,event:t}}}},He=function(e){return function(t){return{type:ce,payload:{getAgent:e,event:t}}}},Ge=function(e){return{type:Z,payload:{getAgent:e}}},We=function(){return{type:re,payload:void 0}},ze=function(e){return{type:ie,payload:e}},Je=function(e){return function(t){return{type:le,payload:{getAgent:e,condition:function(e){return function(e){return e.turn<=t}}}}}};function Ye(e,t){console.log("Action"),console.log(t);var n=t.payload;switch(t.type){case X:var r=B(function(t){return k(ve(e),t)})({ap:1})(e.items),a=r.filter(Oe(e.turn)),i=B(Oe(e.turn))({type:"crop"})(a),u=F(r)(i),c=i.map(function(t){return{id:I(),type:"CROP_GROWN",itemId:t.id,turn:e.turn}}),o=[].concat(Object(A.a)(e.events),Object(A.a)(c)).filter(function(t){return t.turn===e.turn}),l=P(ve(e),u).map(function(t){return Object(O.a)({},t,{events:[].concat(Object(A.a)(t.events),Object(A.a)(o.filter(function(n){return Te(t)(n)(e)||t.training})))})});return u=F(u)(l),Object(O.a)({},e,{items:u,turn:pe(e.turn,ve(e)),activePlayerId:me(ve(e)),winner:ge(e),events:o});case $:var s=n.getAgent,d=s(e);console.log(d);var f=je(s)(e)(d.conditionalActions);return f?Ye(e,f):Ye(Ye(e,Ne(s)),t);case re:var v=e.behaviors;return Object(O.a)({},j(),{behaviors:v});case ie:return Object(O.a)({},e,{selectedId:n});case K:var m=n.getAgent,p=n.getTarget,g=m(e),y=p(m)(e);if(!D(g,y))return console.log("target not in range!"),e;var E=Object(O.a)({},y,{hp:y.hp-1});return Y(L(E),be(t))(e);case te:var b=n.getAgent,T=n.getTarget;return Y(function(e){return L(z(b(e),W(T(b)(e))))(e)},be(t))(e);case q:return he(n.getAgent,"farm",Ee(t,e));case Q:return he(n.getAgent,"warehouse",Ee(t,e));case ne:return he(n.getAgent,"planted",Ee(t,e));case ee:var x=n.getAgent(e),C=M(e.items)(x)("crop"),N=V(Object(O.a)({},x,{resources:[].concat(Object(A.a)(x.resources),["crop"])}),e);return Ae(n.getAgent)("grass")(C.id)(Ee(t,N));case oe:var _=n.getAgent(e),w=M(e.items)(_)("farm"),R=Object(O.a)({},w,{resources:[].concat(Object(A.a)(w.resources),[_.resources[0]])}),U=Object(O.a)({},_,{resources:_.resources.slice(1)});return Y(L(U),L(R),be(t))(e);case ce:var S=n.getAgent,H=n.event;return V({id:S(e).id,behaviorTraining:{name:"farmer",eventType:H.type,event:H,conditionalActions:[]},training:!0},e);case Z:var G=(0,n.getAgent)(e),J=G.behaviorTraining,se=J.name,de=J.eventType,ye=J.conditionalActions,xe=e.behaviors[se]||{},Ie=Object(O.a)({},xe,Object(h.a)({name:se},de,{eventType:de,conditionalActions:ye})),Ce=Object(O.a)({},e,{behaviors:Object(O.a)({},e.behaviors,Object(h.a)({},se,Ie))});return V(Object(O.a)({},G,{behaviorTraining:{},conditionalActions:ye,training:!1}),Ce);case ae:var _e=n.event,we=(0,n.getAgent)(e);return V(Object(O.a)({},we,{activeEvent:_e}),e);case ue:var ke=n.getAgent,Re=ke(e),Pe=Re.events.length>0?Re.events[0]:{type:"DEFAULT_EVENT"},Me=fe(Re.behaviorName)(Pe.type)(e).map(function(e){return Object(O.a)({},e,{payload:Object(O.a)({},e.payload,{getAgent:ke})})});return console.log(Me),"DEFAULT_EVENT"!==Pe.type||je(ke)(e)(Me)?(console.log("Updated actions for event: "+Pe.type),V(Object(O.a)({},Re,{activeEvent:Pe,events:Re.events.slice(1),conditionalActions:Object(A.a)(Me)}),e)):Ye(e,Je(ke)(e.turn));case le:var Ue=(0,n.getAgent)(e);return L(Object(O.a)({},Ue,{activeEvent:{type:"SLEEPING"},conditionalActions:[t]}))(e);default:return e}}var Ke={o:"android",x:"directions_walk",mounted:"direction_bike",grass:"crop_free",tree:"nature",water:"waves",rock:"landscape",dead:"airline_seat_flat",farm:"home",crop:"local_florist",planted:"minimize",warehouse:"layers"},$e=function(e){return e.hp<1?Ke.dead:Ke[e.type]||"crop_free"},qe=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=[],r=0;r<e;r++){n[r]=[];for(var a=0;a<e;a++)n[r][a]=Qe(t,a,r)}return n},Qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find(function(e){return e.x===t&&e.y===n})||{x:t,y:n,type:"."}};function Xe(e){var t,n=e.elem,i=Object(r.useContext)(qt).dispatch;return a.a.createElement(v.a,null,a.a.createElement(b.a,{onClick:(t=n.id,function(){i(ze(t))})},a.a.createElement(y.a,null,$e(n))))}function Ze(){var e=Object(r.useContext)(qt).state.items,t=qe(10,e);return a.a.createElement("div",{className:"PlayingField"},a.a.createElement(l.a,{padding:"none"},a.a.createElement(d.a,null,t.map(function(e){return a.a.createElement(p.a,{key:e[0].y},e.map(function(e){return a.a.createElement(Xe,{key:"x"+e.x+"y"+e.y,elem:e})}))}))))}var et=n(27),tt=n.n(et),nt=n(28),rt=n.n(nt),at=n(18),it=n.n(at),ut=function(e){return function(t){return P(e,t).filter(function(e){return e.ap>0})}};function ct(e){var t=e.action,n=e.children,i=Object(r.useContext)(qt),u=i.state,c=i.dispatch;if(!lt(t)(u))return null;return a.a.createElement(it.a,{onClick:function(){return c(t)}},n)}function ot(){var e,t=Object(r.useContext)(qt),n=t.state,i=t.dispatch,u=n.items,c=n.activePlayerId;return a.a.createElement(it.a,{onClick:(e=c,function(){ut(e)(u).forEach(function(e){i(_e(se(e.id)))}),i(xe())})},"Turn(",c,"): ",n.turn)}var lt=function(e){return function(t){var n=e.payload,r=n.getAgent,a=n.condition;return!!r&&function(e){return function(t){var n=e(t);return n.ap>0&&n.playerId===t.activePlayerId}}(r)(t)&&a(r)(t)}};function st(e){var t=e.targetId,n=Object(r.useContext)(qt).state,i=se(n.selectedId),u=Ce(i)(function(){return se(t)});return a.a.createElement(ct,{action:u},"Attack Enemy")}var dt=function(e){return function(t){return function(n){return n.items.filter(function(t){return t.type===e}).sort((r=t(n),function(e,t){var n=J(r);return n(e)-n(t)}))[0];var r}}},ft=function(e){return function(t){return t.items.filter(function(n){return"farm"===n.type&&n.builderId===e(t).id})[0]}};function vt(){var e=dt("grass");return a.a.createElement(yt,{getTarget:e,targetName:"Grass"})}var mt=function(e){return function(t){var n=e(t).activeEvent;return se(n.itemId)(t)}};function pt(){return a.a.createElement(yt,{getTarget:mt,targetName:"Event"})}function gt(){return a.a.createElement(yt,{getTarget:ft,targetName:"Home"})}function yt(e){var t=e.getTarget,n=e.targetName,i=Object(r.useContext)(qt).state,u=se(i.selectedId),c=Le(u)(t);return a.a.createElement(ct,{action:c},"Move To ",n)}function Et(){var e=Object(r.useContext)(qt).state,t=de(e),n=se(t.id),i=we(n);return a.a.createElement(ct,{action:i},"Build warehouse")}function bt(){var e=Object(r.useContext)(qt).state,t=de(e),n=se(t.id),i=Pe(n);return a.a.createElement(ct,{action:i},"Build farm")}function ht(){var e=Object(r.useContext)(qt).state,t=de(e),n=se(t.id),i=Ue(n);return a.a.createElement(ct,{action:i},"PlantCrop")}function At(){var e=Object(r.useContext)(qt).state,t=de(e),n=se(t.id),i=De(n);return a.a.createElement(ct,{action:i},"HarvestCrop")}function Ot(){var e=Object(r.useContext)(qt).state,t=se(e.selectedId),n=Fe(t);return a.a.createElement(ct,{action:n},"Unload Resource")}function Tt(){var e=Object(r.useContext)(qt).state;return a.a.createElement("div",null,a.a.createElement(tt.a,null,a.a.createElement(rt.a,null,a.a.createElement(ot,null),S(e).map(function(e){return a.a.createElement(st,{key:e.id,targetId:e.id})}),a.a.createElement(vt,null),a.a.createElement(pt,null),a.a.createElement(gt,null),a.a.createElement(Et,null),a.a.createElement(bt,null),a.a.createElement(ht,null),a.a.createElement(At,null),a.a.createElement(Ot,null))))}var jt=n(13),xt=n.n(jt),It=n(81),Ct=n.n(It);function Nt(){var e=Object(r.useContext)(qt).state,t=de(e);if(void 0===t)return null;var n=t.id,i=t.playerId,u=t.x,c=t.y,o=t.hp,l=t.ap,s=t.type,d=t.resources,f=o/5*100,v={type:"DEFAULT_EVENT",itemId:t.id};return a.a.createElement(tt.a,null,a.a.createElement(rt.a,null,a.a.createElement(xt.a,null,"id:",n),a.a.createElement(xt.a,null,"player:",i),a.a.createElement(xt.a,null,"x:",u),a.a.createElement(xt.a,null,"y:",c),a.a.createElement(xt.a,null,"hp:",o),a.a.createElement(xt.a,null,"ap:",l),a.a.createElement(xt.a,null,"type:",s),a.a.createElement(xt.a,null,"resource: ",d," "),a.a.createElement(Ct.a,{variant:"determinate",value:f}),a.a.createElement(wt,{event:v}),a.a.createElement(kt,null)))}function _t(e){var t=e.event,n=Object(r.useContext)(qt),i=n.state,u=n.dispatch,c=de,o=c(i);if(void 0===o||o.activeEvent===t)return null;return a.a.createElement(it.a,{color:"default",onClick:function(){return u(Be(c)(t))}},"Select event ",t.type)}function wt(e){var t=e.event,n=Object(r.useContext)(qt),i=n.state,u=n.dispatch,c=se(i.selectedId),o=c(i);if(!o||o.training)return null;return a.a.createElement(it.a,{color:"default",onClick:function(){u(Be(c)(t)),u(He(c)(t))}},"Train ",t.type," Behavior")}function kt(){var e=Object(r.useContext)(qt),t=e.state,n=e.dispatch,i=se(t.selectedId),u=i(t);if(!u||!u.training)return null;return a.a.createElement(it.a,{color:"default",onClick:function(){return n(Ge(i))}},"Finish train event Behavior")}function Rt(e){var t=e.event,n=Object(r.useContext)(qt).state,i=t.itemId&&se(t.itemId)(n)||{},u=i.x,c=i.y,o=i.type;return a.a.createElement(tt.a,null,a.a.createElement(rt.a,null,a.a.createElement(xt.a,null,"type:",t.type),a.a.createElement(xt.a,null,"x:",u),a.a.createElement(xt.a,null,"y:",c),a.a.createElement(xt.a,null,"itemType:",o),a.a.createElement(_t,{event:t}),a.a.createElement(wt,{event:t})))}function Pt(){var e=Object(r.useContext)(qt).state,t=e.events,n=de(e);return(n.activeEvent?[n.activeEvent].concat(Object(A.a)(t)):t).map(function(e,t){return a.a.createElement(Rt,{key:"event"+t,event:e})})}function Mt(){return a.a.createElement("div",null,a.a.createElement(Nt,null),a.a.createElement(Pt,null))}var Ut=n(87),St=n.n(Ut),Dt=n(29),Lt=n.n(Dt),Vt=n(82),Ft=n.n(Vt),Bt=n(86),Ht=n.n(Bt),Gt=n(84),Wt=n.n(Gt),zt=n(85),Jt=n.n(zt),Yt=n(83),Kt=n.n(Yt);function $t(){var e=Object(r.useContext)(qt),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement(Ft.a,{open:!!t.winner,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(Kt.a,{id:"alert-dialog-title"},"The winner is ".concat(t.winner,"!")),a.a.createElement(Wt.a,null,a.a.createElement(Jt.a,{id:"alert-dialog-description"},"Play another round?")),a.a.createElement(Ht.a,null,a.a.createElement(it.a,{onClick:function(){return n(We())},color:"primary"},"Yes"))))}var qt=a.a.createContext(null),Qt=j();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(function(){var e=Object(r.useReducer)(Ye,Qt),t=Object(c.a)(e,2),n=t[0],i=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement(St.a,null),a.a.createElement(Lt.a,{container:!0,justify:"center",direction:"row",spacing:24},a.a.createElement(qt.Provider,{value:{state:n,dispatch:i}},a.a.createElement($t,null),a.a.createElement(Lt.a,{item:!0,xs:!0},a.a.createElement(Mt,null)),a.a.createElement(Lt.a,{item:!0,xs:!0},a.a.createElement(Ze,{size:"10"})),a.a.createElement(Lt.a,{item:!0,xs:4},a.a.createElement(Tt,null)))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},89:function(e,t,n){e.exports=n(213)},94:function(e,t,n){},95:function(e,t,n){}},[[89,1,2]]]);
//# sourceMappingURL=main.9ca3cce7.chunk.js.map